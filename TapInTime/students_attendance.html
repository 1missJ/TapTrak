<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Attendance - <?php echo $section; ?></title>
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .center-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .center-column span {
            font-size: 18px;
            color: #333;
            font-weight: bold;
        }

        .info-line {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            font-size: 16px;
            font-weight: bold;
        }

        .info-line label {
            margin-right: 5px;
        }

        .info-line span {
            white-space: nowrap;
        }

        select, input[type="date"] {
            padding: 8px 10px;
            font-size: 15px;
            border-radius: 5px;
            border: 1px solid #ccc;
            width: 200px;
            text-align: center;
            font-weight: bold;
        }

        h2 {
            text-align: center;
            margin-bottom: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden;
        }

        thead {
            background-color: #007bff;
            color: white;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        tbody tr:hover {
            background-color: #f1f1f1;
        }

        .no-data {
            text-align: center;
            font-style: italic;
            color: #999;
        }

        .present {
            color: green;
            font-weight: bold;
        }

        .absent {
            color: red;
            font-weight: bold;
        }

        .export-buttons-fixed {
            position: fixed;
            bottom: 20px;
            right: 30px;
            z-index: 1000;
        }

        .export-buttons-fixed select {
            appearance: none;
            background-color: #f0f0f0;
            padding: 8px 10px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: 90px;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
        }

        #subPeriodSelect {
    -webkit-appearance: none;
    -moz-appearance: none; 
    appearance: none; 
    background-image: none;
}

    </style>
</head>
<body>
    <div class="container">
        <div class="navigation">
            <ul>
                <li class="brand-logo">
                    <a href="#">
                        <div class="logo-container">
                            <img src="assets/imgs/dahs.jpg" alt="TapInTime Logo">
                        </div>
                        <span class="title">TapInTime</span>
                    </a>
                </li>                    
                
                <li>
                    <a href="dashboard.php">
                        <span class="icon"><ion-icon name="home-outline"></ion-icon></span>
                        <span class="title">Dashboard</span>
                    </a>
                </li>
    
                <li>
                    <a href="student_verification.php">
                        <span class="icon"><ion-icon name="checkmark-done-circle-outline"></ion-icon></span>
                        <span class="title">Student Verification</span>
                    </a>
                </li>
    
                <li>
                    <a href="student_details.php">
                        <span class="icon"><ion-icon name="people-circle-outline"></ion-icon> </span>
                        <span class="title">Student Information</span>
                    </a>
                </li>
    
                <li>
                    <a href="id_generation.php">
                        <span class="icon"><ion-icon name="card-outline"></ion-icon></span>
                        <span class="title">ID Generation with RFID</span>
                    </a>
                </li>
    
                <li>
                    <a href="faculty_registration.php">
                        <span class="icon"><ion-icon name="school-outline"></ion-icon></span>
                        <span class="title">Faculty Registration</span>
                    </a>
                </li>
    
                <li>
                    <a href="subject_management.php">
                        <span class="icon"><ion-icon name="library-outline"></ion-icon></span>
                        <span class="title">Subject Management</span>
                    </a>
                </li>
    
                <li>
                    <a href="attendance_monitoring.html">
                        <span class="icon"><ion-icon name="stats-chart-outline"></ion-icon></span>
                        <span class="title">Attendance Monitoring</span>
                    </a>
                </li>
    
                <li>
                    <a href="student_promotion.php">
                        <span class="icon"><ion-icon name="ribbon-outline"></ion-icon></span>
                        <span class="title">Students Promotion</span>
                    </a>
                </li>
    
                <li>
                    <a href="user.php">
                        <span class="icon"><ion-icon name="person-outline"></ion-icon></span>
                        <span class="title">Users</span>
                    </a>
                </li>
    
                <li>
                    <a href="index.php">
                        <span class="icon"><ion-icon name="log-in-outline"></ion-icon></span>
                        <span class="title">Sign out</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <div class="main-content">
        <div class="attendance-list" id="attendanceList">
            <h2>Attendance Records</h2>
            <div class="info-line">
                <span id="modalFirstName">LRN: 123456789120</span>
                <span id="modalMiddleName">Name: John Doe</span>

                <label for="subjectSelect">Subject:</label>
                <select id="subjectSelect">
                    <option value="select">Select</option>
                    <option value="math">Math</option>
                    <option value="english">English</option>
                </select>

                <div class="period-group">
                    <label for="periodSelect">Period:</label>
                    <select id="periodSelect">
                        <option value="">Select</option>
                        <option value="monthly">Monthly</option>
                        <option value="quarterly">Quarterly</option>
                    </select>
                </div>
                
                <div class="sub-period-line" id="subPeriodContainer" style="display:none;">
                    <select id="subPeriodSelect"></select>
                </div>                
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Remark</th>
                    </tr>
                </thead>
                <tbody id="attendanceTableBody">
                    <!-- Dynamic rows will be inserted here -->
                </tbody>
            </table>
        </div>
    </div>

    <div class="export-buttons-fixed">
        <select id="exportSelect">
            <option value="export">Export</option>
            <option value="word">Word</option>
            <option value="excel">Excel</option>
        </select>
    </div>

    <script>
        const attendanceData = {
            "123456789120": {
                "english_monthly_january": [
                    { date: "2025-04-10", time: "08:10AM", remark: "Present" },
                    { date: "2025-04-11", time: "08:10AM", remark: "Absent" },
                    { date: "2025-04-12", time: "08:10AM", remark: "Present" }
                ],
                "english_quarterly_1st_quarter": [
                    { date: "2025-04-10", time: "08:10AM", remark: "Present" },
                    { date: "2025-04-11", time: "08:10AM", remark: "Absent" },
                    { date: "2025-04-12", time: "08:10AM", remark: "Present" },
                    { date: "2025-04-13", time: "08:10AM", remark: "Absent" },
                    { date: "2025-04-14", time: "08:10AM", remark: "Present" }
                ],
                "math_monthly_january": [
                    { date: "2025-04-10", time: "08:10AM", remark: "Present" },
                    { date: "2025-04-11", time: "08:10AM", remark: "Absent" },
                    { date: "2025-04-12", time: "08:10AM", remark: "Present" }
                ],
                "math_quarterly_1st_quarter": [
                    { date: "2025-04-10", time: "08:10AM", remark: "Present" },
                    { date: "2025-04-11", time: "08:10AM", remark: "Absent" },
                    { date: "2025-04-12", time: "08:10AM", remark: "Present" },
                    { date: "2025-04-13", time: "08:10AM", remark: "Absent" },
                    { date: "2025-04-14", time: "08:10AM", remark: "Present" }
                ]
            }
        };

        const lrn = "123456789120";
        const periodSelect = document.getElementById("periodSelect");
        const subPeriodSelect = document.getElementById("subPeriodSelect");
        const subPeriodContainer = document.getElementById("subPeriodContainer");
        const subjectSelect = document.getElementById("subjectSelect");

        const monthlyOptions = ["Select", "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        const quarterlyOptions = ["Select", "1st Quarter", "2nd Quarter", "3rd Quarter", "4th Quarter"];

        function populateSubPeriodOptions(period) {
            subPeriodSelect.innerHTML = "";
            const options = period === "monthly" ? monthlyOptions : quarterlyOptions;
            options.forEach(opt => {
                const option = document.createElement("option");
                option.value = opt.toLowerCase().replace(/\s/g, "_");
                option.textContent = opt;
                subPeriodSelect.appendChild(option);
            });
            subPeriodContainer.style.display = "flex";
        }

        function updateAttendanceTable(key) {
    const tableBody = document.getElementById("attendanceTableBody");
    const exportSelect = document.getElementById("exportSelect");

    tableBody.innerHTML = "";

    const data = attendanceData[lrn]?.[key];

    if (data && data.length > 0) {
        // Add rows to the table
        data.forEach(record => {
            const row = `<tr>
                <td>${record.date}</td>
                <td>${record.time}</td>
                <td class="${record.remark.toLowerCase()}">${record.remark}</td>
            </tr>`;
            tableBody.innerHTML += row;
        });

        // Show the export dropdown if data is available
        exportSelect.style.display = 'block';
    } else {
        tableBody.innerHTML = '<tr><td colspan="3" class="no-data">No records found for this selection.</td></tr>';

        // Hide the export dropdown if no data is available
        exportSelect.style.display = 'none';
    }
}

function tryUpdateTable() {
    const subject = subjectSelect.value;
    const period = periodSelect.value;
    const subPeriod = subPeriodSelect.value;

    if (!subject || !period || !subPeriod) {
        // Clear the table and hide the export button when selections are incomplete
        document.getElementById("attendanceTableBody").innerHTML = '<tr><td colspan="3" class="no-data">Please select a subject, period, and sub-period to view attendance.</td></tr>';
        document.getElementById("exportSelect").style.display = 'none';
        return;
    }

    const key = `${subject}_${period}_${subPeriod}`;
    updateAttendanceTable(key);
}


periodSelect.addEventListener("change", () => {
    const selected = periodSelect.value;
    subPeriodSelect.innerHTML = '<option value="">Select Sub-period</option>';
    subPeriodSelect.value = ""; // Reset sub-period value

    if (selected === "monthly" || selected === "quarterly") {
        populateSubPeriodOptions(selected);
        subPeriodContainer.style.display = "flex";
    } else {
        subPeriodContainer.style.display = "none";
    }

    // Optional: reset table since selections are not complete yet
    document.getElementById("attendanceTableBody").innerHTML = '<tr><td colspan="3" class="no-data">Please select a subject, period, and sub-period to view attendance.</td></tr>';
});

        subPeriodSelect.addEventListener("change", tryUpdateTable);
        subjectSelect.addEventListener("change", tryUpdateTable);

        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function exportToWord() {
            const subject = subjectSelect.value;
            const period = periodSelect.value;
            const subPeriod = subPeriodSelect.value;

            const subjectText = capitalize(subject);
            const periodText = capitalize(period);
            const subPeriodText = capitalize(subPeriod.replace(/_/g, " "));

            const lrnText = document.getElementById("modalFirstName").textContent;
            const nameText = document.getElementById("modalMiddleName").textContent;

            const fileName = `${subjectText}_${periodText}_${subPeriodText}_Attendance.doc`;
            const attendanceTable = document.querySelector("table").outerHTML;

            const infoTable = `
                <table>
                    <tr>
                        <td><strong>${lrnText}</strong><br><strong>${nameText}</strong></td>
                        <td><strong>Subject:</strong> ${subjectText}<br><strong>Period:</strong> ${periodText} - ${subPeriodText}</td>
                    </tr>
                </table>`;

            const fullHTML = `<html><head><meta charset='utf-8'></head><body>${infoTable}${attendanceTable}</body></html>`;
            const blob = new Blob([fullHTML], { type: 'application/msword' });

            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function exportToExcel() {
            const subject = subjectSelect.value;
            const period = periodSelect.value;
            const subPeriod = subPeriodSelect.value;

            const subjectText = capitalize(subject);
            const periodText = capitalize(period);
            const subPeriodText = capitalize(subPeriod.replace(/_/g, " "));

            const lrnText = document.getElementById("modalFirstName").textContent;
            const nameText = document.getElementById("modalMiddleName").textContent;

            const fileName = `${subjectText}_${periodText}_${subPeriodText}_Attendance.xls`;
            const attendanceTable = document.querySelector("table").outerHTML;

            const infoTable = `
                <table>
                    <tr>
                        <td><strong>${lrnText}</strong><br><strong>${nameText}</strong></td>
                        <td><strong>Subject:</strong> ${subjectText}<br><strong>Period:</strong> ${periodText} - ${subPeriodText}</td>
                    </tr>
                </table>`;

            const fullHTML = `<html xmlns:x="urn:schemas-microsoft-com:office:excel"><head><meta charset="UTF-8"></head><body>${infoTable}${attendanceTable}</body></html>`;
            const blob = new Blob([fullHTML], { type: 'application/vnd.ms-excel' });

            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        document.getElementById("exportSelect").addEventListener("change", function () {
            const selected = this.value;
            if (selected === "word") exportToWord();
            else if (selected === "excel") exportToExcel();
        });

        // Initial setup: hide export dropdown until data is shown
document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("exportSelect").style.display = 'none';
});

    </script>

    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</body>
</html>
